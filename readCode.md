# bio.c
bcache是一个双向循环链表，有一个头结点，每一个表项都有一个锁`buffer`。  
## `binit`
这个函数构建了链表。  
大致的方式是这样的：
```
[0] HEAD
[1] HEAD --- (0)
[2] HEAD --- (1) --- (0)
[3] HEAD --- (2) --- (1) --- (0)
......
[n] HEAD --- (N) --- (N-1) ---
```

## `bread`
读取一个锁住的buf.  
首先通过[`bread`](#bread)获取buf；如果没有的话，就会用[`virtio_disk_rw`](#virtio_disk_rw) 重新获取

## `bwrite`
写回buf。
`bwrite`只有在获取锁的时候才能调用  

## `brelse`
释放一个buf的内容。  
只有在持有buf锁的时候才能调用。  
会递减引用计数；如果引用计数为0，则在链表中删掉它，并移到最前面去。大概是这样：
```
[0]  ....---(a)---(b)---(c)---....
[1]  HEAD---(b)---(d)---....---(a)----(c)----...
```
这样做能保证最前面是free的，节省了查找的时间。


## `bpin`
获取buf内容，增加引用计数

## `bpin`
减小引用计数

## `bget`
查找cache表。找到了返回一个指针。这个不会被release掉，因为有引用计数。  
如果没有，采用LRU，找到一个空闲的块。